---
title: "영상처리 기반 신호등 인식"
excerpt: ""

categories:
  - 영상처리
tags:
  - 영상처리
---
### Color Space 다루기
- Color Space
  - RGB 색상 공간의 특성
    - 조명에 따른 색상 표현의 차이
      - Outdoor과 Indoor에서의 차이
      - 그림자가 진 곳에서는 더 인식되기 어려움  
    - RGB 색상은 RED, GREEN, BlUE 값의 선형 조합에 의해 얻어짐
    - 문제점: 조명과 그림자에 따른 지각 불균일성

  - HSV 색상 공간의 특성
    - 색상(Hue): 색 종류(노란색, 빨간색, 파란색 등등)
    - 채도(Saturation): 선명도(원색에 가까울수록 채도가 높음)
    - 명도(Value): 밝기(명도가 높을수록 백색, 낮을수록 흑색에 가까워짐)
  
- 작업 폴더 생성
  - ROS workspace의 src 아래에 폴더 생성
    - $ mkdir traffic_sign  
  - 서브 폴더 만들기
    - $ mkdir src
  
- tf_hsv.py
  - 신호등 이미지를 HSV로 변환 예제
  
### 이미지에서 형태 찾기
- 원형 검출하기
  - Hough Transform 알고리즘으로 원형 검출하기  
  - tf_circle.py
  - HoughCircles 함수
    - cv2.HoughCircles(image, method, dp, minDist[, circle[, param1[, param2, minRadius[, maxRadius]]]])
    - cv2.HoughCircles(이미지, 검출방법, 해상도 비율, 최소거리, 캐니엣지임계값, 중심임계값, 최소반지름, 최대반지름)
      - 검출 방법은 항상 2단계 허프변환(cv2.Hough_GRADIENT)만 사용
      - 해상도 비율은 원의 중심을 검출하는데 사용되는 누산평면의 해상도를 의미
        - 인수를 1로 지정할 경우 입력한 이미지와 동일한 해상도를 가짐(즉, 입력 이미지 너비와 높이가 동일한 누산 평면이 생성됨)
        - 또한 인수를 2로 지정하면 누산 평면의 해상도가 절반으로 줄어 입력 이미지의 크기와 반비례함  
      - 최소거리는 일차적으로 검출된 원과 원 사이의 최소 거리로 이 값은 원이 여러 개 검출되는 것을 줄이는 역할
      - 캐니엣지 임계값은 허프변환에서 자체적으로 캐니 엣지를 적용하게 되는데, 이때 사용되는 상위 임계값을 의미
      - 중심 임계값은 그레디언트 방법에 적용된 중심 히스토그램(누산 평면)에 대한 임계값, 값이 낮을 경우 더 많은 원 검출
      - 최소반지름과 최대반지름은 검출될 원의 반지름 범위, 0을 입력할 경우 검출할 수 있는 반지름에 제한조건을 두지 않음
        - 최소반지름과 최대반지름에 각각 0을 입력할 경우 반지름을 고려하지 않고 검출하며, 최대 반지름에 음수를 입력할 경우 검출된 원의 중심만 반환  
    - 원과 원 사이의 최소거리 설정
    - Canny Edge 임계값 설정
    - 중심 임계값 설정
    - 최소/최대 반지름 크기 설정
  
  - Blurring 노이즈 제거
    - 너무 많은 원을 찾는 경우 노이즈 제거가 제대로 되지 않았을 수가 있음
  
  - 원형 검출하기 - tf_circle_green.py, tf_circle_baduk1.py, tf.circle_baduk2.py
  
### 신호등 인식하기
- 신호등 구의 위치 찾기
  - 신호등 이미지에서 구의 위치를 찾기
  - i[0], i[1]: 원의 중심좌표 (x, y)
  - i[2]: 원의 반지름
  
- 신호 판별하기
  - V 성분으로 점등된 구를 판별
    - 원내의 사각 영역 픽셀값들의 범위를 기준으로 Light의 ON/OFF를 판정함  
  - tf_circle_mean.py
    - 색으로 구분하는 것이 아니라 원의 순서로 파악
  
- 우리나라의 신호등 체계
  - 빨강 노랑 화살표 녹색
  - 빨강 노랑 녹색