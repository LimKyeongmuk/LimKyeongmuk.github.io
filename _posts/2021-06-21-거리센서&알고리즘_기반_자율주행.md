---
title: "거리센서 & 알고리즘 기반 자율주행"
excerpt: ""

categories:
  - 시뮬레이터
tags:
  - Pygame
  - 시뮬레이터
---
### 자이카 2D 시뮬레이터
- 자이카 시뮬레이터(Xycar Simulator)
  - 실제 자이카 대신 가상공간에서 차량의 주행 실험을 하기 위한 도구
  - 모터제어 토픽을 보내 시뮬레이터 안의 차량을 조종할 수 있음
  - 시뮬레이터 내부의 자동차가 한바퀴 돌아 원점으로 돌아오면 초기화
  - 주행 중에 벽이나 장애물에 부딫히면 초기화
  - 주행 시간을 표시함
  - 자이카의 핸들의 움직임과 같고 주고 받는 토픽도 같게끔 구현
  - 모터 제어 토픽을 보내서 시뮬레이터 차량 조종 가능
  - 빨간 선으로 초음파 센서 구현(Ultrasonic 토픽)
  
- 사뮬레이터 사용 환경 구축
  - pip(python package index) 도구 설치
    - 방법 1
      >> $ sudo apt update
      >> $ sudo apt-get install python-pip
      
    - 방법 2
      >> $ cd ~
      >> $ sudo apt install curl
      >> $ curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
      >> $ python ~/get-pip.py
      
  - Pygame 1.9.6 설치
    - 파이썬 게임 제작 라이브러리
    - pip install pygame==1.9.6
  
  - Pillow 6.2.2 설치
    - 파이썬 이미지 라이브러리
    - pip install pillow==6.2.2

- 시뮬레이터 설치
  - 자료실에서 xycar_sim_drive.tgz 파일을 다운받은 후
  - ~/xycar_ws/src 위치에 압축을 해제하고 다음 명령어로 빌드
  - $ cm
  
- 시뮬레이터에서 사용되는 노드와 토픽
  - 2개의 노드와 2개의 토픽
    - 'driver' 노드는 차량을 운전하는 운전자(토픽 xycar_motor_msg)
    - 'simulator' 노드는 가상 공간에 있는 자동차(토픽 ultrasonic)
  
- 실행
  - $ roslaunch xycar_sim_drive xycar_sim_drive.launch
  - 자동차가 앞으로만 쭉 직진
  - 차량의 초기위치는 랜덤으로 배치
  - 빨간 선의 길이는 초음파센서의 거리값
  - 좌측상단에 주행시간이 표시됨
  
- 시뮬레이터 안의 차량 조종 방법
  - 차량을 움직이기 위해서
    - "xycar_motor_msg" 토픽으로 [angle, speed] 값을 메시지에 담아 전송해야 함
    
- 시뮬레이터 안의 거리센서
  - 시뮬레이터는 장애물까지의 거리를 "ultrasonic" 토픽에 담아 발행
  - Int32MultiArray 형태로 8개의 값을 담고 있음
  - 데이터 저장 순서: [정면좌측, 정면중앙, 정면우측, 후면좌측, 후면중앙, 후면우측, 우측, 좌측]
  - 시뮬레이터에는 후방 센서가 존재하지 않으므로 후면좌측, 후면중앙, 후면우측 값은 항상 0
  
- 거리센서로부터 토픽 받기
  - "ultrasonic" 토픽을 수신하고 그 값을 출력하는 코드
  
- 시뮬레이터 맵 설정
  - '口' 코스
    - ~/xycar_sim_drive/map/口.so 파일을 ~/xycar_sim_drive/src/ 아래로 복사
    - 파일이름을 map.so로 변경(기존 map.so 파일에 overwrite)  
  - '凹' 코스
    - ~/xycar_sim_drive/map/凹.so 파일을 ~/xycar_sim_drive/src/ 아래로 복사
    - 파일이름을 map.so로 변경(기존 map.so 파일에 overwrite)
  
### 거리센서를 이용한 알고리즘 기반 미로 주행
- ROS 파이썬 프로그래밍
  - 목표
    - 거리센서 값을 이용하여 차량이 벽과 충돌하지 않도록 주행시켜보기
    - 차량이 벽에 부딪히지 않고, 한바퀴를 돌아 출발점으로 돌아오기
    - 알고리즘 만들어 주행하기
    - 주행속도는 25로 고정하기
    - 2개 트랙에서 모두 성공할 수 있게 만들기
  
### 미로주행 과제
- 과제 1
  - 거리센서 값을 이용해서 차량이 벽과 충돌하지 않도록 주행시키기
    - 장애물이 있는, 좌회전/우회전이 모두 필요한 미로 주행('ㄹ.so')
    - 끝까지 가면 차량이 반대 방향으로 다시 주행
    - 총 주행 회수는 (편도 주행 x 3번)
  
- 과제 2
  - 본인이 만든 Pygame 기반 차량 주행 시뮬레이터를 이용
    - 거리센서 붙이기
    - 시뮬레이터가 거리센서 데이터를 발행하도록 수정
    - 미로 만들기
    - 목적지 설정하고 목적지에 도착하면 주행시간 표시하기
  
- 시뮬레이터 활용
  - 자율주행을 위한 인공지능, 머신러닝 활용에 유용하게 사용