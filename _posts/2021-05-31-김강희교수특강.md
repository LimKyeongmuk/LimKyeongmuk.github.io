---
title: "김강희 교수님 특강"
excerpt: ""

categories:
  - Xycar
tags:
  - Xycar
  - Lidar
---
- 숭실대학교 AI 융합학부 김강희 교수(khkim@ssu.ac.kr)
- 자율주행 연구 경력 5년

- 자율주행차 이론과 실체
  - 자율주행 기술 동향
    - 자율주행차 경진대회
    - Waymo vs Tesla
  - 자율주행차 기초이론
    - Sensors
    - Software pipelines
      - Localization pipeline(Robotics)
      - Detection pipeline(AI)
      - Planning & Control pipeline(Robotics)
  - 자율주행 스택
    - Autoware stack
    - Our customized lchthus stack
  - 연구성과
  - 연구 주제
  
실제에서 Robotics가 30퍼센트 정도 AI가 70퍼센트 정도(오늘 강의에서는 Robotics의 중점에서 강의 진행 예정)
- 자율주행 경진 대회 최근 현황
- 2004 Grand Challenge
  - 세계 최초의 무인 자동차 장거리 대회
  - 100개 이상 팀 참여, 완주차량 없음
  
- 2005 Grand Challenge
  - 195개팀 참여, 결승전 23개팀 진출
  - 1위: Stanford 대학의 Stanley 팀
  - 세바스찬 thrun이 지도 교수
  
- 2007 Urban Challenge
  - 위의 대회는 사막이었지만 이 대회는 도심
  - 96km 도시 구간으로 6시간 이내 완주
  - 1위: CMU와 GM의 합작팀
  - 2위: Staford 대학 Junior팀(이름은 바꼈지만 여전이 세바스찬 쓰런이 지도교수)
  
* 세바스찬 쓰런의 업적
  - 세바스찬 쓰런의 제자들이 구글에 입사해서 구글 X(웨이모의 전신)
  - 세바스찬 쓰런이 자율주행 기술을 널리 학습하기 위해서 유다시티.com 이라는 웹 사이트를 제작함
  
- 미국
  - 2021.10.23 Final
  - Indy500이라는 대회
  - 미국의 Indianapolis에서 대회
  - 레이싱카를 자율주행카로 제작해서 대회
  - 한국에서는 카이스트 팀이 유일하게 참가
  
- 유럽에서는 Autonomous 챌린지
  - https://roborace.com/
  - 2019 Season Alpha
  - 2020-21 Season Betta
  - DevBot 2.0 with NVIDIA Drive 사용
  
- 일본: MotoBot
  - 2017 Tokyo Motor Show
    - Motobot 2.0 by Yamaha
    - 무인 오토바이(autonomous motorcycle-riding robot)
  
- 한국
  - 현대자동차 자율주행자동차 경진대회
    - 2019.07 경기도 화성 K-City(12개팀 참가)
    - 홀수년도에 개최
  
  - 산업통상자원부 자율주행 경진대회
    - 2020.10 대구시 수성구 알파시티(15개팀 참가)
    - 짝수년도에 개최
  
  - 위의 2개는 실차 자율주행 대회
  
Waymo vs Tesla
- Sensor Suite
  - The Waymo Driver(5세대 차량)
    - 라이다, 카메라, 레이다 등 다양한 센서를 갖고있음
  
  - 테슬라
    - 라이다는 없고 8개의 카메라, Front radar만 사용, 12개의 Ultrasonic sensors
  
- HD Map vs Non-HD Map
  - 웨이모
    - 웨이모의 장점이자 단점
    - HD Map(고정밀 지도, 고상세 지도)
    - 2020.11 video: https://youtu.be/gnqiOVhEZh0
    - Point Map + Lane-level Vector Map(차선까지 다보이는 벡터 맵)
  
  - 테슬라
    - 2020.11 video: https://youtu.be/pvUDyXI9IUg
    - 카메라로 즉시 지도를 만들음
    - Feature Map, Road-level Vector Map(길만 보이는 벡터 맵)
  
- Strategic Positioning
  - Business model: B2B vs B2C
    - 웨이모는 B2B
      - 웨이모가 만들어낸 차량을 일반 소비자에사 판매하지 않고 택시나 트럭, 택배 서비스를 본인들이 진행하려고 함
      - 소비자에게 서비스를 제공할 생각(차량을 제공하려는 생각이 아님)
    - 테슬라는 B2C
      - 소비자에게 직잡 차량 판매
  
  - AV vs ADAS
    - AV
      - 완전 자율주행에 가까움
    - 테슬라는 ADAS level
      - ADAS는 level 2정도의 기술
  
    - 자율주행 차량에서 운전자가 개입하지 않고 달린 거리는 웨이모가 상당히 높음
    - 테슬라는 순위권에 존재하지 않음(ADAS 즉, 운전자 보조이기 때문에)
  
- SAE Levels
  - level 2는 ADAS
  - level 3부터 자율주행이라고 인정함
  - level 2와 3는 스스로 차로 변경(테슬라는 깜빡이를 키면 차선변경을 시도함)
  - 웨이모는 level 4 진행(특정 상황을 제외하고 공식적으로 운전자가 없어도 되는 상황)
  - 웨이모에는 피닉스라는 도시에서 시험운영중
  
- 테슬라의 단점
  - 기껏해봤자 level 2의 ADAS 레벨
- 웨이모의 단점
  - Geo Fence의 한계: 고정밀지도가 작성된 곳에서만 동작
  
- 이용재 질문
  - 웨이모의 정밀지도 업데이트?
  - 구글 입장에서는 본인들의 자산을 활용(이미 미국의 지도를 모두 갖고있음)해서 지도
  - 테슬라 입장에서는 도심에서는 정밀지도가 필요하지만 고속도로 같은 곳에서는 정밀지도보다 실제 상황과 차선을 인식하는게 좋다고 주장
- 황휘동 질문
- 실차에서는 어떤 시뮬레이션을 진행하는지?
  - 카메이커, 카세임 등의 유료 시뮬레이션
  - 오픈소스 시뮬레이터(칼라, lgsvl)
  - 실차에서는 차량의 다이나믹스를 기록함
  - 타이어와 노면의 마찰지수등을 얘기함
  - 그런 상황도 시뮬레이션이 됨
  - 서스펜션 
  - ROS 시뮬레이터 사용하려면 파티클 시뮬레이터: 점 한개로 이루어진 시뮬레이터
  - 구체적인 모델링이 없고 파티클 수준의 운동을 진행하는 것
  
- 자율주행 기초 이론
  - 실차에서 사용되는 기초 이론
  - Sebastian's Udacity(www.udacity.com)에서 온라인 유료 교육을 진행함
  - C++, Python, 확률통계, 박사과정 학생들이 들으면 좋은 수업
  - Probabilistic ROBOTICS 서적, 2010년 이전에 작성되었지만 자율주행에서 많이 사용되는 기초 이론들이 나옴
  
- localization 측위 기술, 차량의 궤적을 어떻게 생성하는가 이 두 가지를 알고 있어야 자율주행의 전체적인 그림이 그려짐
  
- Sensors
  - LiDAR(3D)
    - 레이저빔을 쏴서 첫번째 장애물에 튕긴 거리를 측정, 고정밀지도와 비교해서 내 차량이 어디에 있는지 파악
    - localizaion에서 사용되지만 object detection 장애물 탐지에도 사용됨
    - 100~300m까지 나감
    - 64채널 라이다 가격이 높음
    
  - Camera(2D)
    - 탐지거리가 낮은편(차량용 카메라에서 탐지거리를 높였다고 해도 낮은 편)
    - 실제 유효 탐지거리는 50~100m
    - 장면 이해에 사용
    
  - Radar(2D)
    - 빛이 아닌 전파를 360도 방향으로 쏴서 장애물의 위치를 알아냄
    - 장애물의 위치뿐만 아니라 tracking 가능
    - LiDAR와 다르게 장애물의 속도도 측정해줌(장애물의 이동 경로를 예측할 수 있음)
    - 도플러 효과에 힘 입어서 속도 측정 가능
    - 고속으로 이동하는 물체들도 탐지 가능(Lidar도 탐지하지만 위치만 보고 속도를 탐지하지 못함)
    - 날씨에 강함(라이다와 카메라는 날씨에 매우 민감)

  - GNSS
    - GPS(미국 위성 브랜드)
    - 베이더우(중국)
    - 글로나스(러시아)
    - 갈릴레오(유럽)
    - 강대국들은 위성들을 갖고있음
    - 요즘에는 수신기 이름은 GNSS라고 부름
    - 다른 모든 나라의 신호를 받아들일 수 있음
    - 고정밀 GPS, GNSS가 있으면 라이다가 필요없다는 의견이 있지만 그렇지 않음
    - 주차장, 터널 등에서는 위치를 잡을 수 없기 때문에
  
- Software Pipelines
  - 자차 위치 추정
    - 3D Point Map(측위)
    - GPS와 Lidar 도움 받음
  
  - 장애물 탐지
    - 라이다와 레이더 카메라를 통해서 탐지
    - 3차원 Bbox로 표현 (한계 상자들, 좌표와 크기)
    
  - 기존 경로 생성
    - Vector Map 상에서 진행
  
  - 후보 궤적 생성
    - 여러 개를 만듦
  
  - 장애물이 탐지되면 다른 후보 궤적으로 갈아탐
  - 실내 로봇은 그 자리에서 멈춰서서 기존 경로를 새로 계산함
  - 실내에서는 고속으로 이동할 필요가 없기 때문에
  - 자동차는 그 때 기존 경로를 다시 계산할 시간이 없기 때문
  
  - Localization + Detection -> Planning & Control
  
- Localization: Point Map
  - 측위에 사용되는 지도
  - 3차원 공간 상에 존재하는 모든 사물들을 점들로 표현한 지도
  - 자차 위치 추정 알고리즘의 입력으로 사용됨
  
- Localization: LiDAR Scan
  - 땅바닥 channel 0
  - 하늘 channel 63
  - x, y 평면으로 회전하면 도너츠 모양으로 스캔
  
- Localization: LiDAR Scan Matching
  - 라이다 스캔 포틴트 클라우드
  - 64채널이니까 도너츠 모양으로 나와야하는데 편의상 1개의 채널만 본다고 가정하고 설명
  - 이미 만들어진 지도와 포인트 클라우드를 겹쳐서 매칭하기
  - 자차 측위가 가능함
  
- Planning: Vector Map
  - 고정밀 지도의 다른 지도(다른 하나는 Point Map)
  - 점, 선, 면 등을 벡터 형식으로 표현한 논리적 교통 정보 지도(3D Point map과 함께 사용)
  - 차선 정보, 중앙, 정지선, 횡단보도 등을 표현한 것
  - 후보 궤적을 생성하는데 사용함
  
- Planning: Trajectory Generation(궤적 생성)
  - 핑크 색이 기존 경로
  - 녹색의 후보 궤적
  
- Planning: Trajectory Generation
  - 기준 경로 center line
  - 실제 나의 trajectory는 점선
  - 이것의 측면 오차를 d
  - 원점부터 이동해온 거리를 s
  - 보통 2차원 좌표는 x, y라고 얘기하는데 기준경로에서는 s, d라고 얘기함
  - 이 차가 기준 경로 대비 얼마나 와있는지 표현
  - 트레젝토리 생성은 lateral과 longitudinal 관점
  - lateral 횡방향(측면)
    - 조향 제어가 기준으로 삼을 차량의 궤적
  - longitudinal 종방향
    - 속도 제어가 기준으로 삼을 차량의 궤적
  
  - 기준 경로에 매핑된 거리 d(t)
  - 장애물이 있었기 때문에 내차가 이동
  - 장애물을 피했으면 기준경로로 다시 이동하기(수렴하기)
  - 운전대를 오른쪽으로 꺾어야하는데 바로 꺾는 것이 중요하지 않고 부드럽게 수렴하게끔 해야함(살살 오른쪽으로 꺾다가 왼쪽으로)
  - 이런 것을 궤적으로 모두 만들어야 함
  - 내 차가 기준 경로로 가면 측면이 줄어드는 속도 d`, d``는 가속도(오차가 줄어드는 속도와 가속도)
  - d가 0이 되도록, d`가 0으로 수렴하도록, d``도 0이 되도록 해야 함
  - Lateral trajectory를 표현하는 5차 함수가 만들어져야 함
  - t0를 대입하면 3개의 방적식, t1를 대입하면 3개의 방정식 총 6개의 방정식이 만들어지므로 5차 다항식이 만들어짐
  
  - 장애물이 언제 어디서 출현할지 모르므로 목표 상태의 후보 궤적도 여러 개를 두고 진행함
  - Lateral trajectory를 만들음
  
  - 속도 제어도 5차 함수를 통해서 만듦
  - 기준 경로를 달려가는 기준 경로 상의 위치(이것도 속도도 0, 가속도도 0이 되어야 차선 앞에 부드럽게 멈추게 됨)
  
  - 100개 100개 곱해서 만개를 만들어서 안전도(cost function)을 통해서 구현함
  
- 측위가 중요함
- Planning도 중요함
- 이 두가지가 Robotics에서 사용
- 장애물 탐지를 통해서 막히고 뚫린 트레젝토리

- 후보 트래젝토리가 많으면 많을 수록 차량이 부드럽게 움직임
- 측면 오차 하나당 10개 이상의 트레젝토리가 생길 수 있음

- Xycar 지도 제작함
  - 2차원 라이다에서 채널 1개로 사용하기 때문에 2차원 view가 만들어짐
  - 자이카는 가속도 제어가 어려움
  - 자이카는 실차와 경험이 다를 수 밖에 없음
  
- 자율주행 오픈소스 스택 Autoware
- 오픈소스 스택
  - Autoware
    - by Autoware Foundation
    - 나고야 대학에서 시작해서 동경대로 자리를 옮긴 심페이카토 교수 주최로 만들어짐
    - 나고야 대학 인원들이 TierV라는 회사를 만들어서 Autoware를 후원함
    - 많은 대학에서 연구해서 실차에 이식해보고 실차로 상용화하는 흐름이 있음
    - 소스코드가 16만줄
    - 논문 자료가 많음
    
  - Apollo
    - 중국의 Baidu라는 검색 엔진 회사가 있는데 Apollo를 공개함
    - 중국 북경에서 올해 하반기부터 자율주행 택시를 운영하는데 Apollo를 사용해서 운영함
    - 소스코드가 32만줄
    - 단점으로 논문 자료를 찾기 어려움
  
- Autoware
  - level 3의 기술
  - 웨이모나 테슬라는 실제 상용화에 진행중이지만 오픈 소스는 버그가 많음
  
- launcher 역할을 해주는 것이 Runtime Manager

- 사용한 OS/Tool/프로그램
  - Mapping Environment
  - Runtime Environment
  - ROS Kinetic

- Autoware의 설명을 위해서는 자율주행의 알고리즘의 깊숙한 부분을 이해

- HD Map Compression
  - 경량화를 하면 측위 오차가 커지는데 경량화에서 측위 오차를 줄이는 것이 핵심
  - 임베디드 보드에 들어가지 않기 때문에
  
- End-to-end Latency Guarantee
  - 카메라에서 이머전시 상황부터 스탑하라는 명령까지의 지연시간이 얼마나 걸리는지 분석
  
- Embedded Cluster Computing
  - 고성능 임베디드 보드
    - Pegasus(7200만원)
      - AI 연산 능력: 320 TOPS
      
    - Xavier 보드(100만원)
      - AI 연산 능력: 300 TOPS(30 TOPS x 100)
  
- 프로그래밍 실력 키우기
  (Python, C++)
- 센서 프로그래밍(3차원 라이다, 실체 라이다) 실력 키우기

- localization을 잘하면 지도 전문 회사로 감
  - 네이버 랩스나 localization 직접적으로 진행함
  - 현대 비즈니스 모델에서는 현대가 고정밀 지도가 만들지 않음
  
- detection 쪽에서는 NN 전문성으로 해봤다면 바닥부터 여러개를 비교 평가해봤어야 함
- Github에 있는것을 한번 돌려본것으로는 먹히지 않음
- 임베디드 최적화 이런 것
- 좀더 도전적으로 해본 것이 성공률이 좋음
  
- 차량 제어쪽은 기계쪽 사람이 좋음, 로컬리제이션은 지도제작 서비스를 타겟팅, 딥러닝을 제너럴하게 하는 것은 너무 많기 때문에 다른 사람들이 많이 하지 않는 틈새시장을 찾아야 함
- 국내에는 좋은 교재가 없음(학부생 수준에서 좋은 교재도 없음)
- 가급직이면 실 센서 데이터를 끌고와서 해보기(논문들이 kitti에서 공개한 데이터로 해보기)
- 유명한 데이터셋으로 도전적으로 해보기

- python하고 C++ 코딩을 잘하는 것(C++은 필수, 하드웨어 관점 or 모델 관점)
- 자율주행에서 딥러닝을 최적화하다보면 
- 차선인식 딥러닝 모델 적용하면 자이카에서는 느릴 것으로 예상
- 차선인식을 실차에서 인식한다고 깃허브에 올라와있는 것에서 자이카에 적용
- 이러한 남들이 하지 않는 것을 해보는 것이 좋음

- 알고리즘을 어떻게 임베디드 보드 위에서 최적화할 수 있는지가 중요