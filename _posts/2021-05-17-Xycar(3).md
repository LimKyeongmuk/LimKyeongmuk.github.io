---
title: "원격 접속 환경 구축"
excerpt: ""

categories:
  - 자율주행
tags:
  - 자율주행
  - Xycar
---
# 자이카 개발환경 소개
- 원격 접속을 이용한 개발환경 구축
  - Xycar의 SW 구성
    - Linux
    - ROS
    - ROS Packages
    - Self Driving(자율주행 관련 SW)
  
  - Xycar는 Linux PC
    - 프로세스 보드 안
      - 유선, 무선 LAN 네트워크 지원
      - USB 포트 제공
      - HDMI 영상출력 커넥터 제공
  
  - Xycar는 컴퓨터 본체
    - 프로세서 + SSD(하드디스크) + 무선랜 + 키보드 + 마우스 + 모니터
  
  - Xycar에 모니터를 붙여서 부팅
    - Tx2 보드와 모니터를 HDMI 케이블로 연결
    - 전원을 켜서 리눅스 부팅 화면이 나타남
    - 리눅스 PC로 사용 가능
  
  - Xycar 리눅스(우분투) 로그인
    - id: nvidia
    - pw: nvidia
  
  - Xycar에 무선으로 접속
    - 무선 와이파이로 Xycar에 접속 가능
    - 차량을 주행시켜 놓고 SW 개발 가능
    - 차량에 장착된 카메라에 찍히는 영상을 그 즉시 확인할 수 있어서 편리
  
  - 리눅스의 원격 접속 기능
    - 리눅스는 원격 접속 기능을 제공
      - 원격 터미널
      - 원격 데스크탑
      - 가상 네트워크 컴퓨팅(VNC)
  
  - 원격 접속
    - Text 기반 접속
      - SSH 원격 접속
      - 보기는 불편하지만 속도가 빠름
      - SSH 프로그램(PuTTY)
      
    - GUI 기반 접속
      - VNC 원격 접속
      - 보기 편하지만 속도가 느림
      - VNC 프로그램(VNC Viewer)
  
  - Xycar는 무선 공유기
    - Xycar가 무선 공유기, 즉 AP로 동작함
  
  - Xycar 와이파이에 접속
    - 모형차에서 제공하는 와이파이 무선랜에 접속
    - 자동차 위에 장착된 프로세서 보드 위에 붙어있는 노란색 라벨
  
  - 스마트폰에서 와이파이 Xycar 접속
    - 와이파이 pw: xycar123
  
  - 스마트폰에서 VNC 이용한 Xycar 접속
    - VNC 앱 구동하고 IP 주소와 비번 입력하여 접속
  
  - 리눅스 PC에서 터미널 사용해서 Xycar 원격 접속
    - $ ssh -Y nvidia@10.42.0.1
    - pw 입력(nvidia)
  
  - 리죽스 PC에서 Remmina 이용한 Xycar 원격 접속
    - 리눅스 기본 원격 데스크탑 프로그램
    - 외부 PC에서 네트워크를 통해 원격지에 있는 리눅스로 로그인할 때 사용
    - 해상도 변경: 바탕화면에 있는 "화면크기 확장" 아이콘에서 모니터 해상도를 1000x1000으로 바꾸면 쉽게 사용 가능

  - 노트북과 스마트폰을 함께 사용 가능
    - 여러 장치들을 동시에 Xycar에 접속할 수 있음
  
# 자이카에 모니터 직접 연결


# 자이카 리눅스 로그인


# 무선 와이파이 접속


# 원격 접속 프로그램 VNC 소개


# 스마트폰에서 자이카로 원격 접속


# 윈도우 PC에서 자이카로 원격 접속


# 리눅스 PC에서 자이카로 원격 접속



# 자이카 주행시키기
### 자이카 와이파이 원격 접속
- 와이파이 무선 원격 접속
  - 여러 장치를 Xycar에 원격으로 접속시킬 수 있음
  
- Xycar 리눅스 바탕화면
  - 바탕화면에 여러 가지 실행 아이콘이 있음
  
- 실행 아이콘
  - 바탕화면 실행아이콘은 ~/Desktop 폴더에 있음
  - 자율 주행: 차선을 인식해서 차선을 벗어나지 않으며 주행
    - 허프 변환 알고리즘을 이용하여 차선을 찾음
  - 뷰어 실행: 장착된 센서들을 모두 기동시키고 센싱데이터를 시각화해 보여줌
  - 사람 인식 주행: YOLO 기반으로 카메라에 잡힌 사람을 쫓아 주행함
    - 장애물이 있으면 멈추고, 사람이 없으면 돌면서 사람을 찾음
    - 카메라 영상 위에 YOLO가 인식한 객체를 사각형으로 묶고 Name을 붙임
  - 화면 크기 확장: VNC 원격접속시 표시되는 화면의 크기를 1000X1000로 확대함
  - 카메라 위치 조정: 카메라 자세를 올바로 세팅하기 위한 자세 세팅용 화면을 보여줌
    - 사용자가 손으로 카메라 자세를 세팅해줌
    - 카메라 자세에 정답은 없고 저번 테스트와 똑같은 자세로 만들어주기  
  - 장애물 회피 주행: 거리센서 기반으로 장애물을 피해서 주행함
    - 카메라 대신 거리센서를 이용해서 주행시킬 때 사용
    - 차량이 직진하다가 장애물이 감지되면 후진했다가 피해서 주행
    - 센싱되는 장애물까지의 거리 정보를 화면에 표시해줌
  - 조이스틱 제어: 안드로이드 앱으로 차량을 수동조작 할 수 있도록 함
    - 터미널 창이 열리고 안드로이드 앱과 통신해서 차량을 구동시키기 위한 ROS 패키지들이 실행됨
    - 속도와 핸들각도 정보가 계속해서 스크롤되며 표시됨
    - 수동 조종을 위한 안드로이드 앱이 필요(XyController.apk 파일을 아래 사이트에서 다운로드 받음)
    - Master URI: http://10.42.0.1:11311/ 입력하고 connect 버튼을 누르기
  - 실행한 프로그램을 끝내고 싶을 때 열린 터미널에서 Ctrl+C 누르기
  
  
### 바탕화면 아이콘

### 프로그램 실행시키기

### 프로그램 종료시키기

# 자이카 SW 플랫폼  
### 자이카 SW 플랫폼
- Xycar에 탑재되는 SW 구성도
  - 시스템 SW
    - 운영체제 - 리눅스
    - 미들웨어 - ROS
    - 라이브러리 - 영상처리/머신러닝
  
### 계층1 - 리눅스
- 우분투 리눅스 설치
- 가장 밑바닥의 SW는 운영체제
- 굉장히 많은 HW와의 모든 작업은 운영체제가 관리함
- 응용 소프트웨어가 HW와 관련 일을 할 때 직접 일을 하지 않도록 도와주는 것
- 운영체제는 파일 시스템, 네트워크, 프로세스 관리, 메모리 관리, 디바이스 드라이버 등을 관리
- 엔비디아 프로세서 보드 위에 리눅스 설치(A모델에서는 Ubuntu 16.04)

### 계층2 - ROS
- Xycar에 기본 설치된 ROS Package

### 계층3 - 라이브러리
- 라이브러리
  - 영상처리/머신러닝/GPU 활용할 수 있는 프로그래밍 코드 덩어리(미리 작성된 코드, 서브 루틴, 클래스 등)

- 자이카에는 다양한 자율 주행 SW의 개발을 위한 다양한 라이브러리 제공
  - OpenCV
    - Open Source Computer Vision
    - 실시간 컴퓨터 비전을 목적으로 한 프로그래밍 라이브러리
    - 실시간 이미지 프로세싱에 중점을 둔 라이브러리
    - 윈도우, 리눅스 등에서 사용가능한 크로스 플랫폼
    - 오픈 소스 BSD 라이선스로 무료로 사용 가능
    - 딥러닝 프레임워크를 지원해서 딥러닝 SW 구현에 쉽게 사용 가능(TensorFlow, PyTorch, Caffe 등 활용 가능)
  
  - TensorFlow
    - 머신러닝 프로그래밍을 위한 소프트웨어 라이브러리(머신러닝 응용프로그램 개발에 사용)
    - 구글내 연구와 제품 개발에 위한 목적으로 구글 브레인팀이 제작
  
  - PyTorch
    - Facebook 인공지능 연구팀이 개발
    - Python을 위한 오픈 소스 머신러닝 라이브러리
    - 속도에 민감한 부분을 제외하고 대부분 파이썬으로 구성
    - 코드가 깔끔하고 직관적인 구조와 사용하기 쉬움
    - 강력한 GPU 가속화를 통환 Tensor 계산으로 속도가 빠름
    - GPU가 있어야 하고 CUDA Toolkit, cuDNN 설치 필요
  
  - CUDA(Compute Unified Device Architecture)
    - GPU에서 수행하는 병령처리 기능을 C언어로 작성할 수 있도록 하는 기술
    - C, 파이썬 등의 코드에서 GPU의 병렬 연산 기능을 손쉽게 사용할 수 있음
    - 딥러닝을 위해서 cuDNN 제공(딥러닝을 위한 GPU 가속화 라이브러리의 기초 요소)
  
  - Python
    - 플랫폼에 독립적이며 인터프리터식, 객체지향적, 대화형 프로그래밍 언어
    - 다양한 플랫폼에서 쓸 수 있고, 라이브러리(모듈)가 풍부
  
# 자율주행차 모터 제어 장치
### 자이카의 모터 장치
- Xycar 하드웨어
  - IMU 센서
  - 카메라 센서
  - 라이더 또는 초음파 센서
  - 구동모터(전후진)
  - 조향모터(핸들조작)
  
- 자동차 구동부
  - 전후진 + 조향(핸들)
  - 무선조종기
  - 구동모터
  - 모터제어기
  - 무선수신기
  - 조향모터
  
- 구동모터
  - 모터의 회전 속도는 공급되는 전력의 양에 따라 결정됨
  - 배터리 전력이 모터제어기를 거쳐 모터로 전달됨
  - 모터의 회전력이 기어 박스를 통해 바퀴의 회전력으로 변환됨
  
- 구동모터의 회전 원리
  - 플레밍의 왼손 법칙
  
- 구동모터(BLDC 모터)
  - U상 코일, V상 코일, W상 코일

- 3상 구동모터 회전 원리
  - 사진
  
- 조향 모터
  - 핸들 조작을 위한 모터
  - 좌우 정해진 각도 내에서 왔다갔다 왕복 동작
  - 서버 모터 사용
  - PWM 신호(Pulse Width Modulation, 펄스 폭 변조)로 모터의 회전각도 조정
  - 5V 출력을 on or off 상태로 유지하는 것이 아니라 빠르게 on/off를 반복하는 것
  
- 모터 제어기
  - ESC(Eletronic Speed Controller)
    - 모터 스피드 제어기
    - ESC -> 무선 조종기를 사용하여 제어(차량의 주행속도, 방향 조절)
  
  - VESC(Vedder ESC)
    - 오픈소스 ESC 프로젝트 결과물
    - 구동모터의 전후진 속도 제어
    - 조향모터의 좌우 회전 제어
  
### 구동모터와 조향모터
### 모터 제어기