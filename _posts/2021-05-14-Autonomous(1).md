---
title: "자율주행 자동차 기술 소개 - 단계별 요소 기술"
excerpt: ""

categories:
  - 자율주행
tags:
  - 자율주행
---
# 자율주행 프로세스
- 자율주행 3단계 프로세스(현대차 홈페이지에 나온 그림)
  - 인지
    - 경로 탐색: 디지털 지도
    - V2X: 차량 간 통신, 인프라 통신
    - ADAS 센서: 카메라, 레이더 등
    - 고정 지물 인식 및 경로 탐색(차로, 차선, 횡단보도, 터널, 고가 등)
    - 변동 지물 및 이동 물체 인식(차량, 보행자, 신호등, 사고차량 등)
    
  - 판단
    - 주행 상황 판단 및 주행전략 결정(차선변경, 주행, 좌/우 회전, 정차 등)
    - 주행 경로 생성(목표 괘적, 목표 속도, 전방 타깃 등)
    
  - 제어
    - 차량 제어(목표 조향각/토크, 목표 가감속)
    - 엔진 가감속, 조향
  
- 사람의 운전 방식
  - 네비게이션의 도움
    - 지도 제공
    - 목적지까지 경로 찾기
    - 좌회전/우회전 경로변경 안내 제공
  
  - 사람이 직접
    - 차선과 지형지물 보고 주행
    - 주변 차량 살펴서 주행
    - 교통 신호등 인식해서 주행
    - 돌발 상황에 대응
  
- 자율주행 SW가 운전하는 방식
  - 자율주행의 경우
    - 보다 정확한 지도가 필요(차선을 구분할 수 있는 지도)
    - 지도에서 자기의 현재 위치 알아내기(GPS, 영상 매칭, 라이다 매칭)
    - 목적지까지 경로 찾기
    - 주변 살피기(각종 센서)
    - 상황에 맞게 속도 조정, 핸들 꺾기
      - 경로 그대로 따라가기
      - 교통 신호 따르기
      - 예외 상황 대처(추월, 정지)
      - 돌방상황에 대처(급브레이크, 장애물 피해가기)
  
- 고정밀 지도
  - HD Map(High Definition Map)
  - 기존 네비게이션, 티맵 지도보다 정밀한 지도(10~20cm 정밀도 제공)
  - 다양한 부가정보 포함(차선 정보, 가드레일, 도로 곡률, 경사, 신호등 위치, 교통 표식)
  - LIDAR, GPS, Camera, Radar, Whill Encoder 등이 필요)
  - 벡터맵
    - 엔비디아: https://www.youtube.com/watch?v=5lydCAYB5N0
    - HERE: https://www.youtube.com/watch?v=8dyo_S3Vxlw
  
  - 포인트맵
    - Point Clouds, Point Map, 3차원 지도
    - LIDAR 정보를 모아서 점을 찍어서 그림
  
  - 백터맵 + 포인트맵
  - 고정밀지도의 제작
    - MMS(Mobile Mapping System): 데이터 수집한 다음, 후처리 작업을 통해 지도 제작
      - 현장 조사: MMS 이용 Point Data 수집
      - Data 처리: 데이터 후처리, LAS 데이터 변환
      - Map 구축: 곡률, 경사도 정보 추출, 객체 추출
      - Data 검수: 데이터 오류 검수 및 검증
      - APP Map: ADAS/HD Map 변환 생성
  
- Localization 기술
  - 정밀 지도와 연동하여 차량의 현재 위치 파악(라이다, 카메라를 이용해 지도의 어느 위치에 있는지 파악)
  - 정밀지도의 land mark와 Lidar와 카메라를 통해서 파악한 자신의 land mark를 비교해서 본인의 위치 파악
  
- Global Path Planning(Route Planning)
  - 목적지까지의 경로 찾기
    - 중간 목적지 또는 최종 목적지까지의 경로
    - 교차로에서의 행위도 결정해야 함
    - 실시간 교통 정보도 반영
    - 현재 네비게이션에도 있는 기술
  
- Object Detection
  - 주변 차량, 보행자, 오토바이, 자전거 등을 인식
  
- Object tracking
  - 각 오브젝트에 고유 ID 부여하여 추적, 예상되는 주행경로 예측
  
- 지도상에서 오브젝트 인식과 추적

- Local Path Planning(Trajectory Planning)
  - 다음 이동할 곳으로의 경로 찾기(충돌 회피 고려)
    - 여러 개의 후부 경로를 확보해야 함
    - 끊임없이 후보 삭제, 신규후보 등록 작업을 반복
    - 실시간성이 중요함(시스템 최적화 필요)

- Behavior Selector
  - 행위 결정
    - 운전 의사 결정
    - 운전 방법, 성향
  
- Local Path Following(Trajectory Following)
  - 경로 따라 차량을 운전하기
  - 사례: Pure pursuit 알고리즘
    - 차량의 현재 위치를 결정함
    - 차량에서 가장 가까운 경로상의 점을 찾음
    - 목표점을 찾음
    - 곡률을 계산하고 해당 곡률로 차량의 방향을 업데이터해줌
    - 차량의 위치를 업데이트함
  
- Vehicle control
  - 주행 제어
    - 원하는 대로 차량을 움직이게 만들기
  
  - 단순하지 않음
    - 차량 운동학
    - 관성도 있고
    - 마찰력, 미끄러짐도 있고
  
- 자율주행 프로세스(사진 첨부)
  - 인지
  - 판단
  - 제어
  
# 프로세스 단계별 요소 기술


# 자율주행 통합플랫폼(Autoware)
- 오토웨어 Autoware(https://www.autoware.org/)
  - 오픈 소스 자율주행 통합 플랫폼
  - SAE-레벨2
  - 실차에 적용 가능한 솔루션
  - 30개 이상의 국가에서 사용, 100개 이상의 회사에서 사용, 20개 이상의 차량 모델에 탑재
  
- 오토웨어 System 아키텍처
  - Senging
    - Camera
    - LiDAR
    - iMU
    - GPS
    
  - Perception
    - Localization
    - Detection
    - Prediction
  
  - Decision
    - Intelligence
    - State
  
  - Planning
    - Mission
    - Motion
  
  - Actuation
    - YMC
    - AS
    - ZMP
    - Custom
  
- 오토웨어 SW 스택(사진 첨부)
  - Hardware
  - OS
  - Runtime
  - Application

- 자율주행 필수 요소 기술(오토웨어 기술 위주)
  - 사진 첨부
  
# 자율주행 자동차 구현 기술 (개발자 관점)
### 자율주행 알고리즘
- 센싱
  - 주변 정보 획득
    - GPS
    - IMU
    - 라이다
    - 초음파
    - 카메라
  
- 인지
  - Localization 자기 위치 파악
    - GPS와 IMU를 조합해서 위치 측정(위치 예측과 업데이트 반복)
    - Stereo 카메라 영상으로 위치 측정
    - 라이다, 포인트 클라우드, 파티클 필터로 위치 측정
    - 여러 센서를 융합하여 정확도 개선
  
  - Object Detection(인식)
    - CNN 딥러닝 기반의 인식모델 사용
  
  - Object Tracking(추적)
    - 개체 이동궤적(trajectory)을 추적
    - 차량, 보행자와의 충돌 회피에 활용
  
- 의사결정
  - 동작 예측
    - 다른 차량의 동작을 예측
    - 확률 모델 만들고 확률 분포 구하기
  
  - 경로 계획
    - Cost function으로 최적 경로 탐색
    - 계산량 줄이기 위해 확률 기법 적용
  
  - 장애물 회피(충돌방지)
    - 1단계 능동형, 충돌까지의 시간과 최소거리 추정치 뽑아서 경로를 다시 계획
    - 2단계 반응형, 이동경로상에 장애물이 감지되면 주행제어 시스템에 개입
  
### 자율주행 클라이언트 시스템
- 소프트웨어
  - 실시간성과 신뢰성 확보 필요
  - ROS 문제점 해결 필요
    - Master가 죽으면 전체 시스템이 다운되며 복구용도의 모니터가 없음. 대책 필요
    - 메시지를 브로드캐스팅 하면서 성능이 저하됨. 멀티캐스팅 메커니즘 적용하면 좋음
    - 노드가 해킹되기 쉬움. 리눅스 컨테이너, 샌드박스로 보안 기능 강화 가능
    - local에서는 TCP/IP 통신 대신에 공유 메모리 통신방식을 적용하면 좋음
    - ROS 2.0 적용?
  
- 하드웨어
  - 성능 향상 필요
    - 파이프라인 병렬 프로세싱 기능 필요
    - HW 가성비 좋게 만들어야 함
    - 차량의 배터리 문제가 있으므로 전력 소모량 최소화 노력 필요
    - 차량이라는 환경에서는 발열 문제가 심각함. 발열을 최소화하거나 열을 쉽게 배출시킬 수 있는 방법을 찾아야 함

### 자율주행 클라우드 플랫폼
- 분산 컴퓨팅
  - 시뮬레이션
    - ROS Bag/Replay
    - 분산 환경으로 처리
  
  - HD 맵 생성
    - 원본 데이터 처리
    - 포인트 클라우드 생성
    - 포인트 클라우드 정렬
    - 2D 반사맵 생성
    - HD 맵 레이블링
  
- 분산 스토리지
  - 딥러닝 모델 학습
    - 학습 데이터 준비
    - 학습 진행
    - 모델의 유효성과 효율성을 지속적으로 업데이트