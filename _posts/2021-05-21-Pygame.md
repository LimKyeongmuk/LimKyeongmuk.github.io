---
title: "Pygame Programming"
excerpt: ""

categories:
  - Pygame
tags:
  - Pygame
---
# Pygame 프로그래밍
### Pygame 개발환경 구축
- Pygame 학습의 목표
  - 간단한 2D 차량 주행 시뮬레이터 제작
  - 남이 만들어 놓은 것을 사용하면 되지 않을까?
    - 자동차의 움직임에 대해서 공부하고 제작해보기 위해서
  
  - 자율주행 = 인지 + 판단 + 제어
  - 제어 = 차량의 움직임을 제어(핸들링 + 가감속)
  
  - 차량의 움직임을 제어하려면 구동 메커니즘을 이해해야 함
  - 키보드로 차량을 조종할 수 있는 시뮬레이터
    - 차량은 진짜 차처럼 Ackermann Steering 방식으로 회전하도록
    - 진짜 차량의 엑셀과 브레이크처럼 동작하도록
    - 진짜 차량의 핸들처럼 동작하도록
  
- Pygame 소개
  - 파이썬 언어를 사용해서 게임을 만들 수 있는 라이브러리
  
- Pygame 개발 환경 구축
  - Windows10 + python + pygame + pillow + numpy + Visual Numpy
  
- Python 3.7 설치

- Pygame 1.9.6 설치

- Pillow 설치
  - python에서 이미지 분석 및 처리를 쉽게 할 수 있도록 도와주는 라이브러리
  
- Numpy 설치

- Visual Studio 2019 설치
  - C++를 사용한 데스크톱 개발 체크
  - MSVC v141 -VS 2017 C++ x64/x86 빌드 체크
  
### Pygame 프로그래밍 기초
- Pygame 기본 구조
  - Pygame 코드 구조
    1) pygame 선언(import)
    2) pygame 초기화(pygame.init())
    3) pygame에서 사용할 전역 변수 선언
      - size(x크기와 y크기)
      - screen(pygame.display.set_mode(size))
      - clock(pygame.time.Clock())  
    4) pygame 메인 루프(while문)
      - pygame Event 설정
      - pygame 화면 설정
      - 사용자 행위

- Pygame 프로그래밍 예제 1
  - 맛보기 예제
    - 발췌: https://kkamikoon.tistory.com/129
    - 화면에 그림 그리기
  
- 코드 분석

- Pygame 프로그래밍 예제 2
  - 키보드 입력을 사용하는 예제
    - 키보드 방향키를 이용해서 동그라미를 상하좌우로 이동하는 프로그램
  
- 코드 분석

# 차량 주행 시뮬레이터 설계
### 시뮬레이터 UI 설계
- 시뮬레이터 UI
  - 스크린 표시
    - 자동차 그림 car.png 표시함
    - 처음 위치는 (100, 100)로 세팅함
    - 차량 바퀴를 표시하지 않음
    - 스크린 크기는 1280x720
    - 바탕색은 검은색
  
  - 키 입력
    - 상/하/좌/우 4방향 키
      - 위쪽
        - 전진할 때, 가속(점점 빨라짐)
        - 후진할 때, 브레이크 기능
      - 아래쪽
        - 잔진할 때, 브레이크 기능
        - 후진할 때, 가속(점점 빨라짐)
      - 오른쪽
        - 바퀴를 오른쪽으로 꺾음
        - 최대 꺾임 각도 30도
      - 왼쪽
        - 바퀴를 왼른쪽으로 꺾음
        - 최대 꺾임 각도 30도
    - 스페이스바
      - 브레이크
  
- 차량의 움직임 정의
  - 좌우 핸들링
    - 좌우 키를 누르고 있으면 바퀴가 조금씩 좌/우로 돌아감
    - 키에서 손을 떼면 바퀴가 즉시 정면으로 되돌아 와서 정렬됨

  - 전진
    - 위쪽 키를 누르고 있으면 엑셀을 계속 밟고 있는 것처럼 속도가 점점 빨라짐
    - 키에서 손을 떼면 엑셀에서 발을 뗀 것처럼 속도가 점차 줄어서 멈춤(마찰력)
    - 아래 방향 키를 누르면 브레이크가 걸린 것처럼 속도가 빨리 줄어서 멈춤(계속 누르고 이;ㅆ으면 후진 가속됨. 정차시키려면 스페이스바 누르기)

  - 후진
    - 위 '전진'의 경우와 동일하게 해서 위/아래 키만 반대로 생각함
  
### HLD(High Level Design) 설계
- pygame_simul_carbody.py 구조 설계
  - 전체 진행 플로우
    - Car 클래서 정의(위치/자세 정보)
    - Pygame 초기화
    - 윈도우 타이틀 지정/크기 설정
    - 전역 변수 설정/클래스 객체 설정
    - while not exit_flags:
      - for 루프(pygame.QUIT 이벤트 처리, while 루프 종료)
      - 키 입력값 읽어들여 if/elif/else 블록에서 처리
      - 차량의 새로운 위치와 자세 계산하고 그림 새로 그리기
      - 화면 업데이트 처리

### LLD(Low Level Design) 설계
- 상세 설계
  - Car class 정의
    - 초기 메소드
    - def update
  
- 선속도 / 각속도
  - 선속도 = 이동거리 / 이동시간
  - 각속도 = 이동각도 / 이동시간
  - 선속도 = 회전 반지름 x 각속도
  
- 차량의 회전 주행
  - 4개의 바퀴를 구하면 힘드니까 앞바퀴와 뒷바퀴의 가상의 바퀴를 구해서 각도를 구하기
  - 회전 반경 구하기
    - 회전반경 = 휠베이스 / tan 세타
    - 휠베이스 = 앞바퀴축과 뒷바퀴축간의 거리
    - 세타 = 조향각
  
- 차량의 이동과 회전
  - 차량 그림 그리기
  - 우선 회전 없이 이동시킨 후 회전시키기
  
- 회전 변환 (X, Y) -> (X`, Y`)
  - 각도 세타만큼 회전할 때의 좌표 변환
  - X` = X cos세타 - Y sin세타
  - Y` = X sin세타 + Y cos세타
  - 회전 변환 행렬
  
- Pygame 그림 작도
  - pygame에서는 바퀴별 각도가 중요하지 않고 x와 y의 최소점인 꼭지점이 중요
  
- SW 구현 준비 완료

### 시뮬레이터 프로그래밍


### 개선하고 보완할 부분
- 브레이크로 인한 감속 가속도 값(스페이스바를 누르는 경우 사용됨)
- 정치 마찰력으로 인한 감속 가속도 값(키 눌림이 없는 경우 적용됨)
- 키보드의 위쪽 방향키가 눌러졌을 경우
- 키보드가 오른쪽 방향키가 눌러졌을 경우
- 조향 관련 키가 아무것도 눌러지지 않았을 경우 너무 빠르게 급정거

- 핸들이 고정되지 않음
- 속도도 고정되지 않음
- 기어(전진/후진)
- 바닥에 차선이 있으면

- 과제
  - 차량의 앞 바퀴 움직임 표시하기