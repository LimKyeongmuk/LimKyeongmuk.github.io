---
title: "자율주행 자율주행 기능 소개"
excerpt: ""

categories:
  - 자율주행
tags:
  - 자율주행
  - Xycar
---
# 자이카 실제 주행 모습
- Xycar 구동 동영상이 YouTube에 많이 있음

# 자율주행 경진대회 모습
- 국민대 모형차 자율주행대회
- 한동대 모형차 자율주행대회
  
# 트랙의 다양한 미션 소개 
- 자이카의 자율 주행 기능
  - 직선 주행
  - 곡선 주행
  - 정지선
  - 돌발 장애물
  - U턴
  - 로터리 진입과 진출
  - 차선 변경
  - 신호등 신호 구분
  - 언덕
  - 요철 구간
  - 주차
  
# 미션을 통과하는 방법
- 차선 따라 주행
  - 카메라 영상을 기반으로 차선을 인식
  - 차선을 벗어나지 않고 주행
  
- 영상에서 차선 찾기
  - 영상 처리
    - OpenCV 기반의 영상ㅇ처리를 통해서 전체 이미지에서 차선의 위치를 파악
    - Color 영상 > Grayscale 변환 > 이진화 변환 > ROI 영역 나눠서 흰색이 많은 곳으로 살펴보기
  
  - 영상 처리(허프 변환)
    1) grayscale
    2) blur
    3) canny edge
    4) ROI
    5) hough transform
    6) result

  - 머신러닝 모델 적용
    - ENet: Real-Time Semantic Segmentation
    - 딥러닝 모델
    - 영상에서 차선 추출
  
- 직진차선? 회전 차선?
  - 화면 중앙과 일치하면 직진
  - 화면 중앙을 벗어나면 오른쪽으로 꺾음(x 픽셀마다 y도 핸들을 꺾어야 함)
  
- 정지선 인식
  - 화면 하단에 ROI 영역 설정
  - 하얀색 필셀이 많으면 또는 수평선이면 정지선으로 인식
  
- 횡단보도 인식
  - OpenCV 함수 사용(도형 개수를 카운트하는 함수)
  - 횡단보도의 경우 여러 개의 블록으로 카운팅
  - 정지선의 경우 한 개의 블록으로 카운팅
  
- 신호등 인식
  - 화면에 ROI 영역 설정해서 연속된 동그라미 찾아서 외곽선만 추출
  - 색상보다는 명도(밝기)로 신호등 상태 정보 획득
  - 또는 YOLO Object 인식하기
  
- 언덕 구간
  - 차선 왜곡 -> 볼록한 항아리 모양으로
  - 한쪽 차선만 보고 가면 곡선 차선으로 오해할 수 있으므로 양쪽 차선을 모두 봐야 함
  - IMU 센서로 언덕주행 인식으로 천천히, 양쪽 차선을 모두 보기

- 장애물
  - 돌발 장애물
    - 라이다를 이용하여 전방 장애물 감지
    - 0~360도, 1도 단위로 거리 센싱
    - (x, y) 좌표로 변환하여 장애물을 위치 판단(진행방향에 장애물 있으면 정지)
  
- 로터리 진입 & 진출
  - 장애물 존재 여부 확인
    - 좌측에서 다가오는 차량 확인
      - 가까이에 없으면 출발
      - 가까우면 지나갈 때까지 기다림
  
    - 우측으로 멀어지는 차량 확인
      - 가까우면 멀어질 때까지 기다림
      - 가까이에 없으면 출발
  
- 차선 변경
  - 자동차가 없는 차선으로 진행
  - 장애물 감지하여 확인
  - 3개 차선 중 장애물이 없는 차선 선택하여 주행
    - 직진, 왼쪽, 오른쪽 차선으로 따라서 주행
  
- QR 코드
  - 지금 어떤 미션을 수행해야 하는지 알려줌(현재 미션에 필요한 알고리즘 코드를 실행)
  
- 항상 동작하는 코드
  - 차선 인식, 차선 따라서 주행
  - 정지선 인식, 차량 멈춤과 재출발
  - 거리센서 기반의 장애물 감지
  
- 성능 문제
  - 많은 기능의 동시 구동은 힘듦
  - 그럴 필요도 없음
  - 그래서 신호 표지판이 필요
  
- 상황 인식의 문제
  - 머신러닝(딥러닝) 기반 인지 기능 적용 가능
  
# 자이카를 사용한 프로젝트
- 자율주행 소프트웨어
  - 규칙기반 주행모델 + 학습기반 주행모델
  - 규칙 기반 주행모델(Rule-based Approach)
    - 차간 거리 유지
      - 주행 과정 중 발생 가능한 다양한 상황을 정교하게 규칙으로 모델링(if문)
      - 학습시켜서 해보는 것은 overhead
      - if 문으로 짜는 것이 더 간단
  
    - Deep Learning & Reinforcement Learning
      - 인간의 주행 과정을 데이터화해 인공지능이 주행 방법을 학습
      - 사람이 운전을 반복하며 익숙해져 가는 과정과 유사
      - 인공지능이 주행을 지속할수록 다양한 상황에서의 대응 방법을 학습하고 터득함
      - 신호문이 없는 교차로 주행 방법 학습 등에서 사용하면 더 효율적
  
- 머신러닝 YOLO 활용 자율주행
  - 전반 상황을 보고 현재 어떤 미션을 수행해야 하는지 파악하기
  - Object를 찾아서 라벨과 영역을 표시
  - 3구 신호등, 4구 신호등, 회전 로터리, 언덕, 3차선 등등 상황에서 해보기
  
- 강화학습 기반 자율주행
  - 가장 기본적인 강화학습 모델 DQN 적용
  - 시뮬레이터에서 벽과 충돌하지 않고 빠르게 주행하도록 만들기
  - 많은 회수의 반복 주행 + 적절한 보상값 부여
  
- End-to-End 자율주행
  - 지도학습
  - 주행 영상 + 조향각 데이터를 학습하여 자율주행이 가능하도록 하는 것
  - 엔비디아에서 자주 사용
  
- Adaptive Cruise Control
  - 추돌 방지 자율주행
  - Lidar 센서를 통한 앞차와의 거리만 있으면 간단히 구현 가능
  
- PID 제어
  - 차량이 흔들리면서 주행하지 않도록 제어(급정거나 급출발을 하지 않도록 하는 제어)
  - 네모판 위에 쇠구슬이 가운데 십자가 위로 가도록 제어
  - High P Gain
  
- AR Tag 기반의 주차
  - AR Tag를 보고 자동차 자세를 파악하여 똑바로 주차
  - 물류창고의 자동차의 위치 셋팅에 자주 활용
  
- YOLO 활용 자율 주행
  - 사람을 찾고 그 사람을 쫓아가는 주행
  
- 직각 주차 / 평행 주차
  - 빈 공간 확인하여 주차 가능 여부 판단
  - 신속하고 정확한 주차
  
- 라이다 기반 복도 주행
  - 최대한 빠르게 주행하면서 코너에서 코너링 구현
  - 머신러닝과 함께 구현
  
- 앞차 따라가기 주행
  - 앞에서 달리는 차량이 지나간 경로를 따라서 주행
  - 실제로 트럭은 군집주행을 자주하므로 많은 연구 진행중
  - 머신러닝 오브젝트 인식하고 앞 차의 이동 궤적 파악
  
- 비보호 좌회전
  - 규칙 기반 vs 학습 기반
  
- 고속 코너링(드리프트 주행)
  - Under Steer, Over Steer는 사고
  - Counter Steer
  - 스탠포드 대학의 MARTY 프로젝트
    - https://www.youtube.com/watch?v=nTK56vPb8Zo  
  - MIT 대학의 머신러닝 기반 드리프트 주행
    - https://www.youtube.com/watch?v=opsmd5yuBFO