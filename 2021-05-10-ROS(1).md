---
title: "ROS 기초"
excerpt: ""

categories:
  - ROS
tags:
  - ROS
---
# ROS의 구조와 기능 소개
### ROS (Robot Operation System)

### ROS가 적용된 네품들
- https://youtu.be/mDwX21Zia8s

### ROS(Robot Operating System)
- 오픈소스 로봇 운영체제
  - 소스 무료 공개
  - 개방형 구조
  - 활발한 커뮤니티 활동
  
- 로봇 소프트웨어를 개발하는데 필요한 소프트웨어의 집합체
  - 소프트웨어 프레임워크(Software Framwork)
  
- 메타 운영체제(Meta OS), 미들웨어(Middleware)
  - 소프트웨어 모듈 + 라이브러리 집합 + 도구 집합(개발에 유용한 도구)
  
- ROS는 자동차(로봇의 일종) 제어를 위한 미들웨어
  - 각종 센서와 모터를 프로그래머가 편하게 사용할 수 있도록 지원
  
### ROS의 구성도

OS

ROS Midedleware

ROS Interaction Layer

Robot Contorl Layer   inter-Agents Communication Layer

Application Logic Support Layer     Knowledge-Base Manipulation Layer

Applications

ROS(Middleware)의 장점: 간단한 기본 기능들은 미리 제공해줌
ROS(Middleware)의 단점: 모든 기능들을 사용할 필요가 없는데 많은 기능이 있음(최적화 작업이 필요)
ROS를 사용해주는 이유: ROS가 쉽고 빠르게 작업이 가능해서 프로토타이핑 도구로서 아주 적합
ROS를 실무에 적용에는 의견이 많음(최적화 작업때문에)

### ROS의 특징
- 로봇 SW를 만들기 위한 코드의 재사용이 용이한 환경 제공이 목표
  - 다양한 프로그래밍 언어를 지원(대표: C++, Python)
  - 표준화된 ROS 인터페이스를 따르는 HW와 SW를 편하게 엮을 수 있음
  - 하드웨어 부품과 소프트웨어 부품을 조립하여 여러 응용 구성 가능
  - 대규모 실행 시스템 및 프로세스에도 적용 가능
  
- 다양한 도구들을 함께 제공
  - RVIZ, RQT, Gazobo ...
  
- 다양한 OS 환경에서 통일된 방법으로 상호작용을 구현하는 것이 가능
  - Linux, OS X, Windows, Paspbian, QNX, ROTS, Android, iOS 등
  - 표준화된 통신 프로토콜을 따르는 이기종 간의 메시지 교환이 가능
  
### ROS가 제공하는 도구들
- RVIZ
  - 시각화 도구
  - 센서데이터를 비롯한 주변환경 변화를 시각화
  
- RQT
  - Qt 기반의 GUI 응용 개발 도구
  - 노드 연결 정보를 그래프로 표현
  - 사용자 상호작용을 UI를 갖춘 응용 개발에 이용
  
- GAZEBO
  - 물리 엔진 기반의 3차원 시뮬레이터
  - 시뮬레이터 제작 및 모델링에 이용
  
### ROS 배포판
- ROS Indigo lgloo(2014)
- ROS Kinetic Kame(2016)
- ROS Lunar Loggerhead(2017)
- ROS Melodic Morenia(2018)
- 숫자 대신에 이름으로 버전을 표현
- LTS: Long Term Support

### ROS에서의 통신
- 토픽의 발행 & 구독 기반의 메시지 교환
  - 노드(프로세스) - publish -> 토픽(메시지) - subscribe -> 노드(프로세스)
  
- ROS 표준만 맞춰주면 성능 문제도 없고 이기종간에 메시지 교환 가능

### ROS의 핵심 기능
- 노드 간 통신을 기반으로 전체 시스템을 구동시킴
  - 하드웨어 부품 또는 소프트웨어 모듈에 노드가 하나씩 할당됨
  - 노드는 OS의 도움을 받아 하드웨어 장치들을 제어함
  - 노드들은 마스터의 도움을 받아서 서로 메시지를 주고 받음
  - 마스터는 노드와 노드 간의 통신을 도와주는 중간의 관제센터 같은 느낌
  
- 네트워크를 통한 원격 연동도 가능
  - 서로 분리된 하드웨어 장치 안에 있는 노드들이 네트워크 연결을 통해 서로 통신하면서 하나의 단일 시스템으로서 동작하는 것이 가능
  
### ROS 기반의 구현 사례
- 라이다 + 카메라 + 모터 + SW모듈1 + SW모듈2
  - 하드웨어 장치 3개와 소프트웨어 모듈 2개를 함께 엮어서 원하는 기능을 구현
  - 아래 설계된 시스템 기능
    - 라이다와 카메라 정보를 상황인지 SW가 분석한 후 결과를 운전 판단 SW로 보내고
    - 운전 판단 SW가 제어 명령을 생성해서 모터로 보내 차량을 움직임
  
### ROS에서 사용하는 기본 용어들
- 마스터(Master)
  - 서로 다른 노드들 사이의 통신을 총괄 관리
  - 통산 'ROS Core'라고 부름
  
- 노드(Nodes)
  - 실행 가능한 최소의 단위, 프로세스로 이해할 수 있음
  - ROS에서 발생하는 통신(메시지 송/수신)의 주체
  - HW 장치에 대해 하니씩의 노드, SW 모듈에 대해 하니씩의 노드 할당
  
- 토픽(Topics)
  - ROS 노드들이 주고 받는 데이터
  - 그 안에 들어 있는 실제 데이터를 메시지라고 부름
  - 예) 센서 데이터, 카메라 이미지, 액츄에이터 제어명령
  
- 발행자(Publishers)
  - 특정 토픽에 메시지를 담아 외부로 송신하는 노드
  - 예) 센서, 카메라, 모터제어 알고리즘
  
- 구독자(Subscribers)
  - 특정 토픽에 담겨진 메시지를 수신하느 ㄴ노드
  - 예) 액츄에이터 제어기, 데이터 시각화 도구 등
  
- 패키지(Packages)
  - 하나 이상의 노드와 노드의 실행을 위한 정보 등을 묶어 놓은 단위
  - 노드, 라이브러리, 데이터, 파라미터 등을 포함
  
### 간단한 ROS 응용 예
- 하드웨어 제조사가 제공하는 ROS 노드들
  - 센서
    - 온도센서 하드웨어 > 온도센서 노드 > 토픽 '온도'
    - 습소센서 하드웨어 > 습도센서 노드 > 토픽 '습도'
    - 각각 어느 토픽에 어떤 형태의 메시지를 발행하는지가 정해져 있음
  
  - 액츄에이터
    - 토픽 "명령" > 에어컨제어 노드 > 에어컨액츄에이터 하드웨어
    - 어떤 토픽에 어떤 메시지를 발행하면 어떻게 동작하는지가 정해져 있음
  
  - 어떤 토픽을 받아서 사용하는지 어떤 토픽을 쏘는지 관련
  
  - ROS Core(마스터)가 이 노드들 사이에 메시지를 통신을 관장함
  - 가운데 ROS 프로그래밍으로 ROS 제어 알고리즘 노드를 만듬(Python으로 짤 예정)
  - '온도' 토픽과 '습도' 토픽을 구독한 후, 제어 알고리즘에 따라서 '명령' 토픽으로 String을 보내줌
  
### ROS 노드간 통신 기본 과정
- 통신이 이루어지기 이전에 통신을 원하는 노드는 마스터에게 의뢰
- 의뢰해서 연결해야하는 노드의 정보(주소)를 얻어오고 서로 접속 정보를 교환

- 통신 환경 구축이 완료되면 노드간 통신은 마스터를 거치지 않고 직접 이루어짐

### ROS 노드간 통신의 두 가지 방식
- 통신(topic) 방식의 통신
  - 일방적이고 지속적인 메시지 전송
  - 1:1 뿐만 아니라 1:N 및 N:N 통신도 가능
  
- 서비스(service) 방식의 통신
  - 서버가 제공하는 서비스에 클라이언트가 요청을 보내고 응답을 받는 방식
  - 양방향 통신, 일회성 메시지 송수신
  
### ROS 노드간 통신 시나리오
1) 마스터(roscore) 시동
  - 통신이 이루어지려면 우선은 rescore가 실행되고 있어야 함
  - 네트워크 통신을 해야하기 때문에 모든 노드에게 마스터의 주소값이 공개되어야 함
  - 마스터는 모든 노드의 정보를 관리

2) 구독자(subscriber) 노드 구동
  - 특정 토픽에 발행하는 메시지를 수신하기를 요청
  - 정보를 구독하려는 노드가 마스터에게 자신의 정보를 제공(노드이름, 받을 토픽, 받을 타입, 본인 주소)

3) 발행자(publisher) 노드 구동
  - 특정 토픽(topic) 메시지를 발행하겠다는 의사를 전달
  - 발행자도 본인의 정보를 마스터에게 전달

4) 노드 정보 전달
  - 마스터가 발행자 정보를 구독자에게 전달

5) 노드간 접속 요청
  - 구독자 노드가 발행자 노드에 TCPROS 접속을 요청

6) 노드간 접속 요청에 대한 응답
  - 발행자 노드가 자신의 TCPROS URI(포트 포함)를 전송하여 응답(자신의 주소와 포트번호)

7) TCPROS 접속
  - 발행자 노드와 구독자 노드 사이에 소켓 연결이 이루어짐

8) 메시지 전송
  - 발행자 노드가 구독자 노드에게 메시지 전송(토픽)
  - 토픽 통신은 일반적

9) 메시지 전송 반복
  - 접속이 한 번 이루어진 뒤에는 별도 절차 없이 지속적으로 메시지 송수신
  - 마스터를 죽이면 전체 시스템이 망가짐

### ROS 기본 용어 Summary
- 마스터(Master)
  - 노드간 통신을 총괄 관리
  - ROS Core
  
- 노드(Node)
  - 토픽을 주고 받는 통신 주체
  - 내가 작성한 프로그램 하나
  - 실행 가능한 최소 단위의 프로세스
  - HW 장치에 하나씩 또는 SW 모듈에 하나씩
  
- 토픽(Topics)
  - 주고 받는 메시지
  - 예) 센서 데이터, 카메라 이미지, 명령
  
- 발행자 노드(Publisher)
  - 토픽을 만들어 보내는 노드
  - 예) 정보수집센서, 카메라
  
- 구독자 노드(Subscriber)
  - 토픽(Topics)를 받는 노드
  - 예) 모터제어기, 정보 수집 SW 모듈
  
- 패키지
  - 하나 이상의 노드와 노드 실행을 위한 정보 등을 묶어 놓은 것
  - 노드, 라이브러리, 데이터, 설정파일 등을 모함
  
# ROS 명령어
- ROS 셀 명령어
  - roscd: 지정한 ros 패키지 폴더로 이동
  - rosls: ros 패키지 파일 목록 확인
  - rosed: ros 패키지 파일 편집
  - roscp: ros 패키지 파일 복사
  
- ROS 실행 명령어
  - roscore: master + rosout + parameter server
    - ros 기본 시스템이 구동되기 위해 필요한 프로그램들을 실행  
    $ roscore
      
  - rosrun: 패키지 노드 실행
    - rosrun [package name] [node_name]: 패키지에 있는 노드를 선택 실행
    
  - roslaunch: 패키지 노드를 여러 개 실행
    - roslaunch [package_name] [file.launch]: 파라미터 값과 함께 노드를 실행
  - rosclean: ros 로그파일 검사 및 삭제
  
- ROS 정보 명령어
  - rostopic: 토픽 정보 확인
    - rostopic [option]: 토픽의 정보를 표시(메시지 타입, 노드 이름 등)
  - rosnode: 노드 정보 확인
    - rosnode [info...]: 노드의 정보를 표시 (발행, 구독 정보)
    
  - rosparam: 파라미터 정보 확인, 수정
  - rosbag: 메시지 기록, 생성
  - rosmsg: 메시지 정보 확인
  - rosversion: 패키지 및 배포 버전 정보 확인
  - roswtf: ros 시스템 검사
  
- ROS catkin 명령어
  - catkin-create-pkg: catkin 빌드 시스템으로 패키지 생성
  - catkin_make: catkin 빌드 시스템으로 빌드
  - catkin_eclipse: 패키지를 eclipse에서 사용할 수 있게 변경
  - catkin_prepare_release: changelog 정리 및 버전 태깅
  - catkin_init_workspace: catkin 빌드 시스템의 작업 폴더 초기화
  - catkin_find: 검색
  
- ROS package 명령어
  - rospack: 패키지와 관련된 정보 보기
  - rosinstall: 추가 패키지 설치
  - rosdep: 해당 패키지의 의존성 파일 설치
  - roslocate: 패키지 정보 관련 명령어
  - rosmake: 패키지 빌드(구 시스템에서 사용)
  - roscreate-pkg: 패키지 자동 생성(구 시스템에서 사용)
  
### ROS에서 제공하는 쓸만한 도구
- rqt_graph
  - 노드와 토픽의 관계 정보를 그래프로 출력
  - $ rqt_graph
  
- RVIZ
  - ROS의 3차원 시각화 도구, 각종 데이터를 보기 좋게 인포그래픽 스타일로 표시
  
# ROS 기본 설치
# ROS 설치
- ROS melodic 설치
1) ROS를 제공하는 Software Repository 등록
2) apt key를 셋업
3-1) 패키지 업데이트
3-2) 패키지 설치
4) rosdep 초기화
5) 쉘 환경 설정
6) 추가로 필요한 도구 등 설치
7) 다음 명령을 실행했을 때 아래 이미지와 같은 화면이 나오면 OK

### ROS 프로그램을 위한 환경 설정
- ROS 워크스페이스 Workspace
- Home 디렉토리 안에 xycar_ws, 그 아래에 src(소스코드), build, devel

### 빌드 명령: catkin_make
- ROS의 workspace에서 새로운 소스코드 파일이나 패키지가 만들어지면 catkin_make 명령을 통해 빌드 작업 진행
- ROS 프로그래밍 작업과 관련있는 모든 것들을 깔끔하게 정리해서 최신 상태로 만드는 작업

### ROS 작업 환경 설정
- ROS 작업에 필요한 환경 변수 설정(홈디렉토리에 .bashrc 파일 수정)

### ROS 예제 프로그램
- 노드 1에서 노드 2로 토픽 전송
- 우분투 터미널 사용법
- 터미널 여러 개 열어서 작업하기
1) 마스터 (roscore)의 실행(터미널 1)

2) ROS node 확인(터미널 4)

3) ROS 노드 실행 - 토픽을 받아서 거북이를 이동시킴(터미널 2)

4) ROS 노드 실행 - 사용자 입력에 맞춰 토픽을 발행함(터미널 3)

5) 노드 사이에 토픽 주고 받기(터미널 4)

6) 토픽 조사(터미널 4)

7) 노드와 토픽 관계 시각화(터미널 4)

8) 토픽을 좀 더 자세히 살펴보기
- 토픽을 찾아보기
- 메시지 타입과 구성 살펴보기

9) ROS 토픽의 메시지가 궁금할 때
- https://wiki.ros.org/에서 찾아보기

 토픽을 직접 발행해보기
 - 토픽의 이름과 그 안에 들어가는 메시지 타입을 알면 임의로 토픽을 보낼 수 있음

주기적으로 반복 발행되는 메시지